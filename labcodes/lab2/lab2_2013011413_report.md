# Lab 2 Report
计35 高思达 2013011413

gsd13@mails.tsinghua.edu.cn

## 练习〇 填写已有实验
使用meld工具可以很方便地进行代码的合并，只需要输入命令：`meld /lab1 /lab2`就能出现图形化的目录对比页面。点开文件后，两个文件中的不一样的地方可以很简单地通过点击来进行同步。但是，由于两个lab之间不同的文件比较多，所以还是需要查阅之前的报告来需找上次更改过的文件。lab1中更改过的是`kern/debug/kdebug.c`和`kern/trap/trap.c`。

由于lab1的challenge没有自己完成，而只是阅读了答案的代码，并直接拷贝到了lab1中添加注释，所以在lab2中并没有加入这部分代码。

为了方便起见，每份报告的一开始都会列出本次实验修改的文件：

* `kern/mm/default_pmm.c`


## 练习一 实现 first-fit 连续物理内存分配算法
#####0、本练习中涉及到的原理课中的知识点

#####1、初步理解代码
* 我们在初始化内存管理的时候，使用的是`default_pmm_manager`，我们实现也是实现它的接口；
* `free_area_t`是真的存放在空闲内存块的头部的，所以其中只有前后指针和大小，而没有指向内存块的指针（或者类似的成员）；
* `default_init`初始化，不涉及探测可用空间的任务，只是准备好一个空的数据结构；

#####2、init\_memmap的理解和实现
* 探测物理内存通过系统调用，所谓`E820`是调用参数；BIOS中通过系统调用填写了这一部分，即存在了`e820map`；
* 调用`init_memmap`的函数是`page_init`，需要注意的是，这时ucore运行在保护模式下，有段机制，所以寻址时的逻辑地址都带有`0xC0000000`的偏移，比如该函数中的`end`。在`page_init`中，函数首先遍历`e820map`中的空闲地址块，统计页数，分配`Page`数组的空间。然后再对每一块调用`init_memmap`。
* 



## 练习二

